// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Season {
  id                 String               @id @default(cuid())
  name               String
  startDate          DateTime
  endDate            DateTime
  isActive           Boolean              @default(true)
  matches            Match[]
  seasonAvailability SeasonAvailability[]
}

model Player {
  id                      String              @id @default(cuid())
  name                    String              @unique
  role                    String              // Batsman, Bowler, All-rounder, Wicketkeeper
  secondaryRole           String?
  battingStyle            String?
  bowlingStyle            String?
  battingPosition         String?             // Top-order, Middle-order, Lower-order
  defaultFieldingPosition String?             // Point, Cover, Mid-off, Long-on, etc.
  isCaptain               Boolean             @default(false)
  isViceCaptain           Boolean             @default(false)
  notes                   String?
  availability            Availability[]
  selections              TeamSelection[]
  seasonAvailability      SeasonAvailability[]
  fieldingPositions       FieldingPosition[]
}

model Match {
  id              String           @id @default(cuid())
  date            DateTime
  opponent        String
  location        String
  type            String           // League, Friendly
  reportingTime   String?          // e.g., "9:00 AM"
  seasonId        String
  season          Season           @relation(fields: [seasonId], references: [id])
  status          String           @default("Scheduled") // Scheduled, Completed, Cancelled
  isLocked        Boolean          @default(false) // Lock after team announcement
  availability    Availability[]
  team            TeamSelection[]
  fieldingSetups  FieldingSetup[]
}

model Availability {
  id        String   @id @default(cuid())
  playerId  String
  matchId   String
  status    String   // AVAILABLE, UNAVAILABLE, MAYBE
  note      String?
  player    Player   @relation(fields: [playerId], references: [id])
  match     Match    @relation(fields: [matchId], references: [id])

  @@unique([playerId, matchId])
}

model TeamSelection {
  id           String  @id @default(cuid())
  matchId      String
  playerId     String
  role         String? // Captain, VC, WK, etc for this match
  battingOrder Int?    // Batting order
  bowlingOrder Int?    // Bowling order
  isSubstitute Boolean @default(false)
  player       Player  @relation(fields: [playerId], references: [id])
  match        Match   @relation(fields: [matchId], references: [id])

  @@unique([matchId, playerId])
}

model SeasonAvailability {
  id                String   @id @default(cuid())
  playerId          String
  seasonId          String
  status            String   // AVAILABLE, UNAVAILABLE, PARTIAL
  unavailableDates  String?  // JSON array of date ranges when partially available
  notes             String?
  player            Player   @relation(fields: [playerId], references: [id])
  season            Season   @relation(fields: [seasonId], references: [id])
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@unique([playerId, seasonId])
}

model FieldingSetup {
  id              String             @id @default(cuid())
  matchId         String
  bowlerId        String?            // Which bowler this setup is for (null = default)
  batsmanType     String             @default("RHB") // RHB (Right-hand), LHB (Left-hand)
  isPowerplay     Boolean            @default(false) // Powerplay vs non-powerplay
  name            String?            // Optional name like "Pace attack", "Spin to LHB"
  match           Match              @relation(fields: [matchId], references: [id])
  positions       FieldingPosition[]
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt

  @@unique([matchId, bowlerId, batsmanType, isPowerplay])
}

model FieldingPosition {
  id               String         @id @default(cuid())
  setupId          String
  playerId         String
  positionName     String         // Point, Cover, Mid-off, etc.
  xCoordinate      Float          // X position on field (0-100 percentage)
  yCoordinate      Float          // Y position on field (0-100 percentage)
  setup            FieldingSetup  @relation(fields: [setupId], references: [id], onDelete: Cascade)
  player           Player         @relation(fields: [playerId], references: [id])

  @@unique([setupId, playerId])
}
